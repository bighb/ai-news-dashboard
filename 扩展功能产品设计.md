# AI èµ„è®¯èšåˆå¹³å° - AI æ™ºèƒ½å¢å¼ºåŠŸèƒ½ PRD

## ğŸ“‹ äº§å“éœ€æ±‚æ–‡æ¡£ (Product Requirements Document)

### ä¸€ã€éœ€æ±‚èƒŒæ™¯

å½“å‰å¹³å°èšåˆäº† Redditã€Hacker News å’Œ arXiv çš„è‹±æ–‡ AI èµ„è®¯ï¼Œç”¨æˆ·éœ€è¦å…·å¤‡ä¸€å®šè‹±æ–‡é˜…è¯»èƒ½åŠ›ã€‚ä¸ºäº†é™ä½é˜…è¯»é—¨æ§›ã€æå‡ç”¨æˆ·ä½“éªŒï¼Œéœ€è¦å¼•å…¥ AI æ™ºèƒ½ç¿»è¯‘å’Œæ‘˜è¦åŠŸèƒ½ï¼Œè®©ä¸­æ–‡ç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿç†è§£å†…å®¹æ ¸å¿ƒã€‚

### äºŒã€äº§å“ç›®æ ‡

1. **é™ä½é˜…è¯»é—¨æ§›**ï¼šæä¾›ä¸­æ–‡æ ‡é¢˜å’Œæ‘˜è¦ï¼Œå¸å¼•æ›´å¤šä¸­æ–‡ç”¨æˆ·
2. **æå‡ä¿¡æ¯å¯†åº¦**ï¼šAI ç”Ÿæˆçš„æ‘˜è¦æ›´ç²¾ç‚¼ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿç­›é€‰å†…å®¹
3. **ä¿æŒåŸæ–‡æº¯æº**ï¼šä¿ç•™åŸæ ‡é¢˜å’Œè·³è½¬é“¾æ¥ï¼Œæ–¹ä¾¿æ·±åº¦é˜…è¯»
4. **é›¶æˆæœ¬è¿è¥**ï¼šä½¿ç”¨æœ¬åœ° Ollama æ¨¡å‹ï¼Œæ—  API è°ƒç”¨è´¹ç”¨

### ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

#### 3.1 åŠŸèƒ½åˆ—è¡¨

| åŠŸèƒ½æ¨¡å— | ä¼˜å…ˆçº§ | è¯´æ˜ |
|---------|--------|------|
| AI æ ‡é¢˜ç¿»è¯‘ | P0 | å°†è‹±æ–‡æ ‡é¢˜ç¿»è¯‘ä¸ºåœ°é“çš„ä¸­æ–‡æ ‡é¢˜ |
| AI å†…å®¹æ‘˜è¦ | P0 | ç”Ÿæˆ 100-150 å­—çš„ä¸­æ–‡æ‘˜è¦ |
| æ•°æ®åº“ç¼“å­˜ | P0 | æ°¸ä¹…å­˜å‚¨ AI ç”Ÿæˆå†…å®¹ï¼Œé¿å…é‡å¤è°ƒç”¨ |
| åå°ä»»åŠ¡é˜Ÿåˆ— | P0 | å¼‚æ­¥å¤„ç† AI ä»»åŠ¡ï¼Œä¸é˜»å¡ç”¨æˆ·è¯·æ±‚ |
| é™çº§å±•ç¤º | P1 | AI å¤±è´¥æ—¶ä¼˜é›…é™çº§åˆ°åŸå§‹å†…å®¹ |
| ä»»åŠ¡ç›‘æ§ | P2 | æŸ¥çœ‹ AI ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å’ŒæˆåŠŸç‡ |

#### 3.2 ç”¨æˆ·äº¤äº’æµç¨‹

```
ç”¨æˆ·è®¿é—®é¦–é¡µ
  â†“
åå°è‡ªåŠ¨è§¦å‘ AI ä»»åŠ¡é˜Ÿåˆ—
  â†“ (å¼‚æ­¥æ‰§è¡Œ)
ç”¨æˆ·çœ‹åˆ°åŸå§‹æ•°æ® + Loading çŠ¶æ€
  â†“ (AI å¤„ç†ä¸­)
Ollama æœ¬åœ°æ¨¡å‹ç”Ÿæˆä¸­æ–‡å†…å®¹
  â†“
å­˜å‚¨åˆ° MySQL æ•°æ®åº“
  â†“
å‰ç«¯è½®è¯¢/WebSocket æ›´æ–°
  â†“
ç”¨æˆ·çœ‹åˆ°å®Œæ•´çš„ä¸­æ–‡æ ‡é¢˜å’Œæ‘˜è¦
```

#### 3.3 é¡µé¢å±•ç¤ºè§„åˆ™

**NewsCard ç»„ä»¶æ”¹é€ **ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ·ï¸ [æ¨¡å‹] Reddit Â· 2å°æ—¶å‰         â”‚
â”‚                                     â”‚
â”‚ ğŸ“Œ åŸæ ‡é¢˜ï¼šIntroducing GPT-5      â”‚
â”‚ ğŸ”¤ ä¸­æ–‡æ ‡é¢˜ï¼šOpenAI å‘å¸ƒ GPT-5    â”‚
â”‚                                     â”‚
â”‚ ğŸ“„ AI æ‘˜è¦ï¼š                        â”‚
â”‚ OpenAI æ­£å¼å‘å¸ƒç¬¬äº”ä»£å¤§è¯­è¨€æ¨¡å‹    â”‚
â”‚ GPT-5ï¼Œåœ¨æ¨ç†èƒ½åŠ›ã€å¤šæ¨¡æ€ç†è§£å’Œ    â”‚
â”‚ ä»£ç ç”Ÿæˆæ–¹é¢å–å¾—æ˜¾è‘—æå‡...        â”‚
â”‚                                     â”‚
â”‚ ğŸ”¥ çƒ­åº¦: 95  ğŸ’¬ è¯„è®º: 234           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é™çº§å±•ç¤ºè§„åˆ™**ï¼š
- AI ç”ŸæˆæˆåŠŸï¼šæ˜¾ç¤ºã€ŒåŸæ ‡é¢˜ + ä¸­æ–‡æ ‡é¢˜ + AI æ‘˜è¦ã€
- AI ç”Ÿæˆä¸­ï¼šæ˜¾ç¤ºã€ŒåŸæ ‡é¢˜ + Loading éª¨æ¶å±ã€
- AI å¤±è´¥ï¼šæ˜¾ç¤ºã€ŒåŸæ ‡é¢˜ + åŸå§‹ summaryï¼ˆå¦‚æœæœ‰ï¼‰ã€

### å››ã€æŠ€æœ¯æ¶æ„è®¾è®¡

#### 4.1 æŠ€æœ¯æ ˆé€‰å‹

| ç»„ä»¶ | æŠ€æœ¯æ–¹æ¡ˆ | è¯´æ˜ |
|-----|---------|------|
| AI æ¨¡å‹ | Ollama + Qwen2.5:7b | é˜¿é‡Œé€šä¹‰åƒé—®ï¼Œä¸­æ–‡èƒ½åŠ›å¼º |
| æ•°æ®åº“ | MySQL 8.0 + Prisma ORM | æ°¸ä¹…å­˜å‚¨ AI å†…å®¹ç¼“å­˜ |
| ä»»åŠ¡é˜Ÿåˆ— | BullMQ + Redis | ä¸“ä¸šçº§ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ”¯æŒé‡è¯•å’Œä¼˜å…ˆçº§ |
| API é€šä¿¡ | Ollama JS SDK | å®˜æ–¹ Node.js å®¢æˆ·ç«¯ |

#### 4.2 æ•°æ®åº“è®¾è®¡

**æ–°å¢è¡¨ï¼šai_enhanced_content**

```sql
CREATE TABLE ai_enhanced_content (
  id VARCHAR(255) PRIMARY KEY,           -- å¯¹åº” NewsItem.id
  original_title TEXT NOT NULL,          -- åŸå§‹æ ‡é¢˜
  translated_title TEXT,                 -- AI ç¿»è¯‘çš„ä¸­æ–‡æ ‡é¢˜
  ai_summary TEXT,                       -- AI ç”Ÿæˆçš„ä¸­æ–‡æ‘˜è¦
  model_name VARCHAR(50),                -- ä½¿ç”¨çš„æ¨¡å‹ (qwen2.5:7b)
  status ENUM('pending', 'processing', 'completed', 'failed'), -- ä»»åŠ¡çŠ¶æ€
  error_message TEXT,                    -- é”™è¯¯ä¿¡æ¯
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_status (status),
  INDEX idx_created_at (created_at)
);
```

#### 4.3 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯ (Next.js)                        â”‚
â”‚  - å±•ç¤ºåŸå§‹æ•°æ® + AI å¢å¼ºæ•°æ®                                 â”‚
â”‚  - è½®è¯¢ AI ä»»åŠ¡çŠ¶æ€ (React Query)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API å±‚ (Next.js API Routes)                 â”‚
â”‚  - GET  /api/aggregate     : èšåˆèµ„è®¯ + æŸ¥è¯¢ AI ç¼“å­˜         â”‚
â”‚  - POST /api/ai/enqueue    : æ‰‹åŠ¨è§¦å‘ AI ä»»åŠ¡                â”‚
â”‚  - GET  /api/ai/status/:id : æŸ¥è¯¢å•ä¸ªä»»åŠ¡çŠ¶æ€                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åå°ä»»åŠ¡é˜Ÿåˆ— (BullMQ)                     â”‚
â”‚  - Queue: ai-translation-queue                               â”‚
â”‚  - Worker: å¹¶å‘å¤„ç† AI ä»»åŠ¡ (å¯é…ç½®å¹¶å‘æ•°)                   â”‚
â”‚  - Retry: å¤±è´¥è‡ªåŠ¨é‡è¯• 3 æ¬¡                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL æ•°æ®åº“     â”‚  â”‚  Ollama æœ¬åœ°æœåŠ¡   â”‚
â”‚  - ç¼“å­˜ AI å†…å®¹   â”‚  â”‚  - Qwen2.5:7b     â”‚
â”‚  - ä»»åŠ¡çŠ¶æ€æŒä¹…åŒ– â”‚  â”‚  - localhost:11434â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Redis ç¼“å­˜       â”‚
            â”‚   - ä»»åŠ¡é˜Ÿåˆ—å­˜å‚¨    â”‚
            â”‚   - é”æœºåˆ¶          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.4 æ ¸å¿ƒä¸šåŠ¡æµç¨‹

**æµç¨‹ 1ï¼šèµ„è®¯èšåˆ + AI ä»»åŠ¡å…¥é˜Ÿ**

```typescript
// src/app/api/aggregate/route.ts (æ”¹é€ )

export async function GET() {
  // 1. å¹¶è¡Œè·å–ä¸‰ä¸ªæ•°æ®æº
  const items = await fetchAllSources();

  // 2. æŸ¥è¯¢ MySQLï¼Œè·å–å·²æœ‰çš„ AI ç¼“å­˜
  const cachedAI = await prisma.aiEnhancedContent.findMany({
    where: { id: { in: items.map(i => i.id) } }
  });

  // 3. åˆå¹¶æ•°æ®ï¼šæœ‰ç¼“å­˜çš„ç”¨ç¼“å­˜ï¼Œæ²¡æœ‰çš„æ ‡è®°ä¸ºå¾…å¤„ç†
  const enrichedItems = items.map(item => {
    const cache = cachedAI.find(c => c.id === item.id);
    if (cache?.status === 'completed') {
      return {
        ...item,
        translatedTitle: cache.translated_title,
        aiSummary: cache.ai_summary,
        aiStatus: 'completed'
      };
    }
    return { ...item, aiStatus: cache?.status || 'pending' };
  });

  // 4. å°†æœªå¤„ç†çš„ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—
  const pendingItems = enrichedItems.filter(i => i.aiStatus === 'pending');
  if (pendingItems.length > 0) {
    await aiQueue.addBulk(
      pendingItems.map(item => ({
        name: 'translate-and-summarize',
        data: { newsItem: item },
        opts: { attempts: 3, backoff: { type: 'exponential', delay: 2000 } }
      }))
    );
  }

  return NextResponse.json({ items: enrichedItems });
}
```

**æµç¨‹ 2ï¼šBullMQ Worker å¤„ç† AI ä»»åŠ¡**

```typescript
// src/lib/ai/worker.ts (æ–°å»º)

const worker = new Worker('ai-translation-queue', async (job) => {
  const { newsItem } = job.data;

  try {
    // 1. æ›´æ–°çŠ¶æ€ä¸ºå¤„ç†ä¸­
    await prisma.aiEnhancedContent.upsert({
      where: { id: newsItem.id },
      update: { status: 'processing' },
      create: {
        id: newsItem.id,
        original_title: newsItem.title,
        status: 'processing'
      }
    });

    // 2. è°ƒç”¨ Ollama API
    const ollamaResponse = await ollama.chat({
      model: 'qwen2.5:7b',
      messages: [{
        role: 'system',
        content: 'ä½ æ˜¯ä¸“ä¸šçš„ AI èµ„è®¯ç¿»è¯‘åŠ©æ‰‹...'
      }, {
        role: 'user',
        content: `æ ‡é¢˜: ${newsItem.title}\næ­£æ–‡: ${newsItem.summary || ''}`
      }]
    });

    // 3. è§£æ JSON å“åº”
    const result = JSON.parse(ollamaResponse.message.content);

    // 4. å­˜å‚¨åˆ°æ•°æ®åº“
    await prisma.aiEnhancedContent.update({
      where: { id: newsItem.id },
      data: {
        translated_title: result.translatedTitle,
        ai_summary: result.summary,
        model_name: 'qwen2.5:7b',
        status: 'completed'
      }
    });

    return { success: true };
  } catch (error) {
    // 5. é”™è¯¯å¤„ç†
    await prisma.aiEnhancedContent.update({
      where: { id: newsItem.id },
      data: {
        status: 'failed',
        error_message: error.message
      }
    });
    throw error; // è§¦å‘ BullMQ é‡è¯•æœºåˆ¶
  }
}, { connection: redisConfig });
```

**æµç¨‹ 3ï¼šOllama Prompt è®¾è®¡**

```typescript
// src/lib/ai/prompts.ts (æ–°å»º)

export const TRANSLATION_PROMPT = `ä½ æ˜¯ä¸“ä¸šçš„ AI èµ„è®¯ç¿»è¯‘å’Œæ‘˜è¦åŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯ï¼š

1. å°†è‹±æ–‡æ ‡é¢˜ç¿»è¯‘æˆåœ°é“ã€ç®€æ´çš„ä¸­æ–‡æ ‡é¢˜
2. åŸºäºæ ‡é¢˜å’Œæ­£æ–‡å†…å®¹ï¼Œç”Ÿæˆ 100-150 å­—çš„ä¸­æ–‡æ‘˜è¦

è¦æ±‚ï¼š
- æ ‡é¢˜ç¿»è¯‘è¦å‡†ç¡®ä¼ è¾¾åŸæ„ï¼Œé¿å…ç›´è¯‘
- æ‘˜è¦è¦çªå‡ºæ ¸å¿ƒä¿¡æ¯ï¼šæ˜¯ä»€ä¹ˆã€æœ‰ä»€ä¹ˆç‰¹ç‚¹ã€æœ‰ä»€ä¹ˆå½±å“
- ä½¿ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€ï¼Œé¿å…è¿‡äºä¸“ä¸šçš„æœ¯è¯­
- å¦‚æœæ˜¯è®ºæ–‡ï¼Œé‡ç‚¹æ¦‚æ‹¬ç ”ç©¶æ–¹æ³•å’Œç»“è®º
- å¦‚æœæ˜¯äº§å“å‘å¸ƒï¼Œé‡ç‚¹è¯´æ˜åŠŸèƒ½å’Œä¼˜åŠ¿

è¯·ä»¥ JSON æ ¼å¼è¿”å›ç»“æœï¼š
{
  "translatedTitle": "ä¸­æ–‡æ ‡é¢˜",
  "summary": "ä¸­æ–‡æ‘˜è¦å†…å®¹"
}`;

export function buildPrompt(newsItem: NewsItem): string {
  const { title, summary, category, source } = newsItem;

  let context = '';
  if (source === 'arxiv') {
    context = 'è¿™æ˜¯ä¸€ç¯‡å­¦æœ¯è®ºæ–‡ï¼Œ';
  } else if (category === 'model') {
    context = 'è¿™æ˜¯å…³äº AI æ¨¡å‹çš„èµ„è®¯ï¼Œ';
  } else if (category === 'tool') {
    context = 'è¿™æ˜¯å…³äº AI å·¥å…·çš„èµ„è®¯ï¼Œ';
  }

  return `${context}è¯·ç¿»è¯‘æ ‡é¢˜å¹¶ç”Ÿæˆæ‘˜è¦ï¼š

æ ‡é¢˜: ${title}
${summary ? `æ­£æ–‡æ‘˜è¦: ${summary.slice(0, 500)}` : ''}

è¯·è¿”å› JSON æ ¼å¼çš„ç»“æœã€‚`;
}
```

### äº”ã€æŠ€æœ¯å®æ–½è®¡åˆ’

#### é˜¶æ®µä¸€ï¼šåŸºç¡€è®¾æ–½æ­å»º (é¢„è®¡ 2-3 å¤©)

**ä»»åŠ¡æ¸…å•**ï¼š

1. **ç¯å¢ƒå‡†å¤‡**
   - [ ] å®‰è£… Ollama (macOS: `brew install ollama`)
   - [ ] å¯åŠ¨ Ollama æœåŠ¡ (`ollama serve`)
   - [ ] ä¸‹è½½ Qwen2.5 æ¨¡å‹ (`ollama pull qwen2.5:7b`)
   - [ ] éªŒè¯æ¨¡å‹è¿è¡Œ (`ollama run qwen2.5:7b "ä½ å¥½"`)

2. **æ•°æ®åº“å‡†å¤‡**
   - [ ] å®‰è£… MySQL 8.0 æˆ–ä½¿ç”¨ Docker (`docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=password mysql:8.0`)
   - [ ] åˆ›å»ºæ•°æ®åº“ `ai_news_dashboard`
   - [ ] é…ç½®æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²

3. **Redis å‡†å¤‡**
   - [ ] å®‰è£… Redis (`brew install redis`)
   - [ ] å¯åŠ¨ Redis æœåŠ¡ (`redis-server`)
   - [ ] éªŒè¯è¿æ¥ (`redis-cli ping`)

4. **é¡¹ç›®ä¾èµ–å®‰è£…**
   ```bash
   pnpm add @prisma/client ollama bullmq ioredis
   pnpm add -D prisma @types/node
   ```

5. **Prisma åˆå§‹åŒ–**
   ```bash
   pnpm prisma init
   # ç¼–è¾‘ prisma/schema.prisma
   pnpm prisma generate
   pnpm prisma db push
   ```

#### é˜¶æ®µäºŒï¼šæ ¸å¿ƒåŠŸèƒ½å¼€å‘ (é¢„è®¡ 3-4 å¤©)

**æ–‡ä»¶åˆ›å»ºæ¸…å•**ï¼š

1. **æ•°æ®åº“å±‚** (`src/lib/db/`)
   - [ ] `prisma.ts` - Prisma å®¢æˆ·ç«¯å•ä¾‹
   - [ ] `ai-content.ts` - AI å†…å®¹ CRUD æ“ä½œ

2. **AI æœåŠ¡å±‚** (`src/lib/ai/`)
   - [ ] `ollama-client.ts` - Ollama API å°è£…
   - [ ] `prompts.ts` - Prompt æ¨¡æ¿ç®¡ç†
   - [ ] `queue.ts` - BullMQ é˜Ÿåˆ—é…ç½®
   - [ ] `worker.ts` - åå° Worker è¿›ç¨‹

3. **API è·¯ç”±** (`src/app/api/`)
   - [ ] `aggregate/route.ts` - æ”¹é€ ç°æœ‰èšåˆæ¥å£
   - [ ] `ai/enqueue/route.ts` - æ‰‹åŠ¨è§¦å‘ AI ä»»åŠ¡
   - [ ] `ai/status/[id]/route.ts` - æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

4. **ç±»å‹å®šä¹‰** (`src/types/`)
   - [ ] æ‰©å±• `NewsItem` ç±»å‹ï¼Œæ·»åŠ  AI å­—æ®µ
   - [ ] æ–°å¢ `AiEnhancedContent` ç±»å‹
   - [ ] æ–°å¢ `AiStatus` æšä¸¾

#### é˜¶æ®µä¸‰ï¼šå‰ç«¯é›†æˆ (é¢„è®¡ 2 å¤©)

1. **ç»„ä»¶æ”¹é€ **
   - [ ] `news-card.tsx` - æ˜¾ç¤ºåŒè¯­æ ‡é¢˜å’Œ AI æ‘˜è¦
   - [ ] `news-grid.tsx` - æ·»åŠ  AI çŠ¶æ€è½®è¯¢
   - [ ] æ–°å¢ `loading-skeleton.tsx` - éª¨æ¶å±ç»„ä»¶

2. **çŠ¶æ€ç®¡ç†**
   - [ ] ä½¿ç”¨ React Query ç®¡ç† AI çŠ¶æ€è½®è¯¢
   - [ ] é…ç½®è½®è¯¢é—´éš”å’Œåœæ­¢æ¡ä»¶

3. **æ ·å¼ä¼˜åŒ–**
   - [ ] è®¾è®¡åŸæ ‡é¢˜å’Œä¸­æ–‡æ ‡é¢˜çš„å±•ç¤ºæ ·å¼
   - [ ] æ·»åŠ  Loading çŠ¶æ€åŠ¨ç”»
   - [ ] ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤º

#### é˜¶æ®µå››ï¼šæµ‹è¯•ä¸ä¼˜åŒ– (é¢„è®¡ 1-2 å¤©)

1. **åŠŸèƒ½æµ‹è¯•**
   - [ ] æµ‹è¯•å®Œæ•´çš„ AI å¢å¼ºæµç¨‹
   - [ ] æµ‹è¯•é”™è¯¯é™çº§é€»è¾‘
   - [ ] æµ‹è¯•å¹¶å‘å¤„ç†èƒ½åŠ›
   - [ ] æµ‹è¯•æ•°æ®åº“ç¼“å­˜å‘½ä¸­

2. **æ€§èƒ½ä¼˜åŒ–**
   - [ ] ä¼˜åŒ– Prompt é•¿åº¦ï¼Œå‡å°‘ token æ¶ˆè€—
   - [ ] è°ƒæ•´ Worker å¹¶å‘æ•°ï¼ˆå»ºè®® 2-3ï¼‰
   - [ ] æ·»åŠ æ•°æ®åº“æŸ¥è¯¢ç´¢å¼•
   - [ ] ä¼˜åŒ–å‰ç«¯è½®è¯¢ç­–ç•¥

3. **ç›‘æ§å’Œæ—¥å¿—**
   - [ ] æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
   - [ ] ç»Ÿè®¡ AI ä»»åŠ¡æˆåŠŸç‡
   - [ ] è®°å½•å¹³å‡å¤„ç†æ—¶é—´
   - [ ] ç›‘æ§ Ollama å†…å­˜å ç”¨

### å…­ã€é…ç½®æ–‡ä»¶ç¤ºä¾‹

#### 6.1 ç¯å¢ƒå˜é‡é…ç½®

**.env.local**

```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL="mysql://root:password@localhost:3306/ai_news_dashboard"

# Redis é…ç½®
REDIS_HOST="localhost"
REDIS_PORT=6379
REDIS_PASSWORD=""  # å¦‚æœæœ‰å¯†ç 

# Ollama é…ç½®
OLLAMA_BASE_URL="http://localhost:11434"
OLLAMA_MODEL="qwen2.5:7b"
OLLAMA_TIMEOUT=60000  # 60 ç§’è¶…æ—¶

# ä»»åŠ¡é˜Ÿåˆ—é…ç½®
AI_WORKER_CONCURRENCY=2           # Worker å¹¶å‘æ•°
AI_RETRY_ATTEMPTS=3               # é‡è¯•æ¬¡æ•°
AI_RETRY_DELAY=2000               # é‡è¯•å»¶è¿Ÿ (ms)
AI_JOB_TIMEOUT=120000             # ä»»åŠ¡è¶…æ—¶ (ms)

# ä»£ç†é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
HTTPS_PROXY=""
HTTP_PROXY=""
```

#### 6.2 Prisma Schema

**prisma/schema.prisma**

```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model AiEnhancedContent {
  id               String   @id @db.VarChar(255)
  originalTitle    String   @map("original_title") @db.Text
  translatedTitle  String?  @map("translated_title") @db.Text
  aiSummary        String?  @map("ai_summary") @db.Text
  modelName        String?  @map("model_name") @db.VarChar(50)
  status           AiStatus @default(pending)
  errorMessage     String?  @map("error_message") @db.Text
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  @@index([status])
  @@index([createdAt])
  @@map("ai_enhanced_content")
}

enum AiStatus {
  pending
  processing
  completed
  failed
}
```

#### 6.3 BullMQ é˜Ÿåˆ—é…ç½®

**src/lib/ai/queue.ts**

```typescript
import { Queue } from 'bullmq';
import Redis from 'ioredis';

const connection = new Redis({
  host: process.env.REDIS_HOST || 'localhost',
  port: parseInt(process.env.REDIS_PORT || '6379'),
  password: process.env.REDIS_PASSWORD,
  maxRetriesPerRequest: null,
});

export const aiQueue = new Queue('ai-translation-queue', {
  connection,
  defaultJobOptions: {
    attempts: parseInt(process.env.AI_RETRY_ATTEMPTS || '3'),
    backoff: {
      type: 'exponential',
      delay: parseInt(process.env.AI_RETRY_DELAY || '2000'),
    },
    removeOnComplete: {
      age: 3600, // 1 å°æ—¶ååˆ é™¤å®Œæˆçš„ä»»åŠ¡
      count: 1000, // æœ€å¤šä¿ç•™ 1000 ä¸ªå®Œæˆçš„ä»»åŠ¡
    },
    removeOnFail: {
      age: 86400, // 24 å°æ—¶ååˆ é™¤å¤±è´¥çš„ä»»åŠ¡
    },
  },
});
```

#### 6.4 Ollama å®¢æˆ·ç«¯é…ç½®

**src/lib/ai/ollama-client.ts**

```typescript
import { Ollama } from 'ollama';

export const ollama = new Ollama({
  host: process.env.OLLAMA_BASE_URL || 'http://localhost:11434',
});

export const OLLAMA_CONFIG = {
  model: process.env.OLLAMA_MODEL || 'qwen2.5:7b',
  options: {
    temperature: 0.3,  // é™ä½éšæœºæ€§ï¼Œæé«˜ç¨³å®šæ€§
    top_p: 0.8,
    top_k: 40,
    num_predict: 400,  // æœ€å¤§ç”Ÿæˆ token æ•°
  },
};
```

#### 6.5 TypeScript ç±»å‹æ‰©å±•

**src/types/index.ts (æ‰©å±•)**

```typescript
// åŸæœ‰ NewsItem ç±»å‹ä¿æŒä¸å˜ï¼Œæ–°å¢å­—æ®µ
export interface NewsItem {
  id: string;
  title: string;
  summary?: string;
  url: string;
  source: "reddit" | "hn" | "arxiv";
  sourceName: string;
  category: "model" | "application" | "tutorial" | "tool" | "research";
  publishedAt: string;
  popularity: number;
  metadata: {
    likes?: number;
    comments?: number;
    upvotes?: number;
    author?: string;
    subreddit?: string;
  };

  // æ–°å¢ AI å¢å¼ºå­—æ®µ
  translatedTitle?: string;   // AI ç¿»è¯‘çš„ä¸­æ–‡æ ‡é¢˜
  aiSummary?: string;          // AI ç”Ÿæˆçš„ä¸­æ–‡æ‘˜è¦
  aiStatus?: AiStatus;         // AI å¤„ç†çŠ¶æ€
}

export enum AiStatus {
  PENDING = 'pending',
  PROCESSING = 'processing',
  COMPLETED = 'completed',
  FAILED = 'failed',
}

export interface AiEnhancedContent {
  id: string;
  originalTitle: string;
  translatedTitle?: string;
  aiSummary?: string;
  modelName?: string;
  status: AiStatus;
  errorMessage?: string;
  createdAt: Date;
  updatedAt: Date;
}
```

### ä¸ƒã€æ ¸å¿ƒä»£ç å®ç°ç¤ºä¾‹

#### 7.1 Prisma å®¢æˆ·ç«¯å•ä¾‹

**src/lib/db/prisma.ts**

```typescript
import { PrismaClient } from '@prisma/client';

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined;
};

export const prisma = globalForPrisma.prisma ?? new PrismaClient({
  log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],
});

if (process.env.NODE_ENV !== 'production') {
  globalForPrisma.prisma = prisma;
}
```

#### 7.2 AI å†…å®¹æ•°æ®è®¿é—®å±‚

**src/lib/db/ai-content.ts**

```typescript
import { prisma } from './prisma';
import { AiStatus } from '@prisma/client';

export async function getAiContent(id: string) {
  return prisma.aiEnhancedContent.findUnique({
    where: { id },
  });
}

export async function getAiContentBatch(ids: string[]) {
  return prisma.aiEnhancedContent.findMany({
    where: { id: { in: ids } },
  });
}

export async function createAiContent(data: {
  id: string;
  originalTitle: string;
  status?: AiStatus;
}) {
  return prisma.aiEnhancedContent.create({
    data: {
      ...data,
      status: data.status || AiStatus.pending,
    },
  });
}

export async function updateAiContent(
  id: string,
  data: {
    translatedTitle?: string;
    aiSummary?: string;
    modelName?: string;
    status?: AiStatus;
    errorMessage?: string;
  }
) {
  return prisma.aiEnhancedContent.update({
    where: { id },
    data,
  });
}

export async function getAiContentStats() {
  const stats = await prisma.aiEnhancedContent.groupBy({
    by: ['status'],
    _count: true,
  });

  return stats.reduce((acc, item) => {
    acc[item.status] = item._count;
    return acc;
  }, {} as Record<AiStatus, number>);
}
```

#### 7.3 Worker è¿›ç¨‹å®Œæ•´å®ç°

**src/lib/ai/worker.ts**

```typescript
import { Worker, Job } from 'bullmq';
import { ollama, OLLAMA_CONFIG } from './ollama-client';
import { TRANSLATION_PROMPT, buildPrompt } from './prompts';
import { updateAiContent } from '../db/ai-content';
import { AiStatus } from '@prisma/client';
import type { NewsItem } from '@/types';

interface JobData {
  newsItem: NewsItem;
}

const worker = new Worker<JobData>(
  'ai-translation-queue',
  async (job: Job<JobData>) => {
    const { newsItem } = job.data;

    console.log(`[Worker] Processing job ${job.id} for item ${newsItem.id}`);

    try {
      // 1. æ›´æ–°çŠ¶æ€ä¸ºå¤„ç†ä¸­
      await updateAiContent(newsItem.id, {
        status: AiStatus.processing,
      });

      // 2. æ„å»º Prompt
      const userPrompt = buildPrompt(newsItem);

      // 3. è°ƒç”¨ Ollama API
      const response = await ollama.chat({
        model: OLLAMA_CONFIG.model,
        messages: [
          {
            role: 'system',
            content: TRANSLATION_PROMPT,
          },
          {
            role: 'user',
            content: userPrompt,
          },
        ],
        options: OLLAMA_CONFIG.options,
        format: 'json', // ç¡®ä¿è¿”å› JSON æ ¼å¼
      });

      // 4. è§£æå“åº”
      const content = response.message.content;
      let result: { translatedTitle: string; summary: string };

      try {
        result = JSON.parse(content);
      } catch (parseError) {
        // å¦‚æœè§£æå¤±è´¥ï¼Œå°è¯•æå– JSON
        const jsonMatch = content.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          result = JSON.parse(jsonMatch[0]);
        } else {
          throw new Error('Failed to parse JSON response from Ollama');
        }
      }

      // 5. éªŒè¯ç»“æœ
      if (!result.translatedTitle || !result.summary) {
        throw new Error('Invalid response: missing translatedTitle or summary');
      }

      // 6. å­˜å‚¨åˆ°æ•°æ®åº“
      await updateAiContent(newsItem.id, {
        translatedTitle: result.translatedTitle,
        aiSummary: result.summary,
        modelName: OLLAMA_CONFIG.model,
        status: AiStatus.completed,
      });

      console.log(`[Worker] Successfully processed item ${newsItem.id}`);

      return {
        success: true,
        itemId: newsItem.id,
        translatedTitle: result.translatedTitle,
      };
    } catch (error) {
      console.error(`[Worker] Error processing item ${newsItem.id}:`, error);

      // 7. æ›´æ–°å¤±è´¥çŠ¶æ€
      await updateAiContent(newsItem.id, {
        status: AiStatus.failed,
        errorMessage: error instanceof Error ? error.message : 'Unknown error',
      });

      throw error; // æŠ›å‡ºé”™è¯¯ä»¥è§¦å‘ BullMQ é‡è¯•
    }
  },
  {
    connection: {
      host: process.env.REDIS_HOST || 'localhost',
      port: parseInt(process.env.REDIS_PORT || '6379'),
    },
    concurrency: parseInt(process.env.AI_WORKER_CONCURRENCY || '2'),
    limiter: {
      max: 10, // æ¯åˆ†é’Ÿæœ€å¤šå¤„ç† 10 ä¸ªä»»åŠ¡
      duration: 60000,
    },
  }
);

// Worker äº‹ä»¶ç›‘å¬
worker.on('completed', (job) => {
  console.log(`[Worker] Job ${job.id} completed`);
});

worker.on('failed', (job, err) => {
  console.error(`[Worker] Job ${job?.id} failed:`, err.message);
});

worker.on('error', (err) => {
  console.error('[Worker] Error:', err);
});

export { worker };
```

#### 7.4 å¯åŠ¨ Worker çš„ç‹¬ç«‹è„šæœ¬

**src/lib/ai/start-worker.ts**

```typescript
import { worker } from './worker';

console.log('[Worker] Starting AI translation worker...');
console.log(`[Worker] Model: ${process.env.OLLAMA_MODEL || 'qwen2.5:7b'}`);
console.log(`[Worker] Concurrency: ${process.env.AI_WORKER_CONCURRENCY || 2}`);

// ä¼˜é›…å…³é—­
process.on('SIGTERM', async () => {
  console.log('[Worker] Received SIGTERM, closing worker...');
  await worker.close();
  process.exit(0);
});

process.on('SIGINT', async () => {
  console.log('[Worker] Received SIGINT, closing worker...');
  await worker.close();
  process.exit(0);
});
```

**package.json æ·»åŠ å¯åŠ¨è„šæœ¬**ï¼š

```json
{
  "scripts": {
    "dev": "next dev",
    "worker": "tsx watch src/lib/ai/start-worker.ts",
    "dev:all": "concurrently \"pnpm dev\" \"pnpm worker\""
  }
}
```

### å…«ã€é£é™©è¯„ä¼°ä¸åº”å¯¹ç­–ç•¥

#### 8.1 æŠ€æœ¯é£é™©

| é£é™©é¡¹ | é£é™©ç­‰çº§ | å½±å“èŒƒå›´ | åº”å¯¹æªæ–½ |
|-------|---------|---------|---------|
| Ollama æœ¬åœ°æ€§èƒ½ä¸è¶³ | ä¸­ | AI ç”Ÿæˆé€Ÿåº¦æ…¢ | 1. é™ä½å¹¶å‘æ•°<br>2. ä¼˜åŒ– Prompt é•¿åº¦<br>3. å‡çº§ç¡¬ä»¶ï¼ˆå¢åŠ å†…å­˜/GPUï¼‰ |
| MySQL è¿æ¥æ•°è€—å°½ | ä¸­ | æ•°æ®åº“æ“ä½œå¤±è´¥ | 1. é…ç½®è¿æ¥æ± <br>2. é™åˆ¶ Worker å¹¶å‘æ•°<br>3. ä½¿ç”¨è¿æ¥å¤ç”¨ |
| Redis å†…å­˜å ç”¨è¿‡é«˜ | ä½ | ä»»åŠ¡é˜Ÿåˆ—å¤±æ•ˆ | 1. è®¾ç½®ä»»åŠ¡è¿‡æœŸæ—¶é—´<br>2. å®šæœŸæ¸…ç†å®Œæˆä»»åŠ¡<br>3. ç›‘æ§å†…å­˜ä½¿ç”¨ |
| AI ç”Ÿæˆè´¨é‡ä¸ç¨³å®š | ä¸­ | ç”¨æˆ·ä½“éªŒå·® | 1. ä¼˜åŒ– Prompt<br>2. æ·»åŠ è´¨é‡æ£€æµ‹<br>3. æä¾›äººå·¥ä¿®æ­£å…¥å£ |
| æ•°æ®åº“ç£ç›˜å ç”¨å¢é•¿ | ä½ | å­˜å‚¨ç©ºé—´ä¸è¶³ | 1. å®šæœŸå½’æ¡£å†å²æ•°æ®<br>2. åªä¿ç•™è¿‘ 30 å¤©å†…å®¹<br>3. å‹ç¼©å­˜å‚¨ |

#### 8.2 ä¸šåŠ¡é£é™©

| é£é™©é¡¹ | é£é™©ç­‰çº§ | åº”å¯¹æªæ–½ |
|-------|---------|---------|
| AI ç¿»è¯‘ä¸å‡†ç¡® | ä¸­ | ä¿ç•™åŸæ ‡é¢˜ï¼Œç”¨æˆ·å¯å¯¹æ¯”æŸ¥çœ‹ |
| æ‘˜è¦é—æ¼å…³é”®ä¿¡æ¯ | ä¸­ | æä¾›ã€ŒæŸ¥çœ‹åŸæ–‡ã€é“¾æ¥ |
| ç”¨æˆ·å¯¹ AI å†…å®¹ä¸ä¿¡ä»» | ä½ | æ ‡æ³¨ã€ŒAI ç”Ÿæˆã€æç¤º |
| ä¸­è‹±æ–‡åˆ‡æ¢éœ€æ±‚ | ä½ | è€ƒè™‘åœ¨ V2.0 æ·»åŠ åˆ‡æ¢åŠŸèƒ½ |

#### 8.3 è¿ç»´é£é™©

| é£é™©é¡¹ | é£é™©ç­‰çº§ | åº”å¯¹æªæ–½ |
|-------|---------|---------|
| Worker è¿›ç¨‹å´©æºƒ | ä¸­ | ä½¿ç”¨ PM2 ç®¡ç†ï¼Œè‡ªåŠ¨é‡å¯ |
| æ•°æ®åº“å¤‡ä»½ç¼ºå¤± | é«˜ | é…ç½®è‡ªåŠ¨å¤‡ä»½ç­–ç•¥ |
| ç›‘æ§ä¸å®Œå–„ | ä¸­ | æ·»åŠ æ—¥å¿—å’Œå‘Šè­¦ç³»ç»Ÿ |
| éƒ¨ç½²å¤æ‚åº¦é«˜ | ä¸­ | ç¼–å†™éƒ¨ç½²æ–‡æ¡£å’Œè„šæœ¬ |

### ä¹ã€æ€§èƒ½æŒ‡æ ‡ä¸ç›‘æ§

#### 9.1 æˆåŠŸæŒ‡æ ‡ (KPI)

**åŠŸèƒ½æŒ‡æ ‡**ï¼š
- AI ç¿»è¯‘è¦†ç›–ç‡ï¼šâ‰¥ 95%ï¼ˆå·²å¤„ç†çš„èµ„è®¯å æ¯”ï¼‰
- AI ç”ŸæˆæˆåŠŸç‡ï¼šâ‰¥ 90%ï¼ˆæˆåŠŸ/æ€»ä»»åŠ¡æ•°ï¼‰
- å¹³å‡ç”Ÿæˆæ—¶é—´ï¼šâ‰¤ 5 ç§’/æ¡
- ç¼“å­˜å‘½ä¸­ç‡ï¼šâ‰¥ 80%ï¼ˆå‡å°‘é‡å¤è°ƒç”¨ï¼‰

**ç”¨æˆ·ä½“éªŒæŒ‡æ ‡**ï¼š
- é¦–å±åŠ è½½æ—¶é—´ï¼šâ‰¤ 2 ç§’ï¼ˆæ˜¾ç¤ºåŸå§‹æ•°æ®ï¼‰
- AI å†…å®¹å±•ç¤ºå»¶è¿Ÿï¼šâ‰¤ 10 ç§’
- é™çº§å±•ç¤ºæˆåŠŸç‡ï¼š100%ï¼ˆAI å¤±è´¥æ—¶æ­£ç¡®å±•ç¤ºåŸå§‹å†…å®¹ï¼‰
- é¡µé¢å¯ç”¨æ€§ï¼šâ‰¥ 99.5%

**ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡**ï¼š
- æ•°æ®åº“æŸ¥è¯¢å»¶è¿Ÿï¼šâ‰¤ 100msï¼ˆP95ï¼‰
- ä»»åŠ¡é˜Ÿåˆ—ååé‡ï¼šâ‰¥ 20 æ¡/åˆ†é’Ÿ
- Worker CPU ä½¿ç”¨ç‡ï¼šâ‰¤ 80%
- Redis å†…å­˜ä½¿ç”¨ï¼šâ‰¤ 500MB

#### 9.2 ç›‘æ§æ–¹æ¡ˆ

**æ—¥å¿—æ”¶é›†**ï¼š

```typescript
// src/lib/logger.ts
import pino from 'pino';

export const logger = pino({
  level: process.env.LOG_LEVEL || 'info',
  transport: {
    target: 'pino-pretty',
    options: {
      colorize: true,
      translateTime: 'SYS:standard',
    },
  },
});

// ä½¿ç”¨ç¤ºä¾‹
logger.info({ itemId: newsItem.id }, 'AI task started');
logger.error({ itemId: newsItem.id, error: err }, 'AI task failed');
```

**æ€§èƒ½ç›‘æ§ API**ï¼š

```typescript
// src/app/api/admin/stats/route.ts
import { prisma } from '@/lib/db/prisma';
import { aiQueue } from '@/lib/ai/queue';

export async function GET() {
  // 1. AI ä»»åŠ¡ç»Ÿè®¡
  const aiStats = await prisma.aiEnhancedContent.groupBy({
    by: ['status'],
    _count: true,
  });

  // 2. é˜Ÿåˆ—ç»Ÿè®¡
  const queueStats = await aiQueue.getJobCounts();

  // 3. å¹³å‡å¤„ç†æ—¶é—´
  const avgProcessTime = await prisma.aiEnhancedContent.aggregate({
    _avg: {
      processingTime: true,
    },
    where: {
      status: 'completed',
      createdAt: {
        gte: new Date(Date.now() - 24 * 60 * 60 * 1000), // æœ€è¿‘ 24 å°æ—¶
      },
    },
  });

  return NextResponse.json({
    aiStats,
    queueStats,
    avgProcessTime: avgProcessTime._avg.processingTime,
  });
}
```

### åã€åç»­è¿­ä»£è§„åˆ’

#### ç‰ˆæœ¬ 2.0ï¼šåŠŸèƒ½å¢å¼º (1-2 ä¸ªæœˆ)

**æ–°å¢åŠŸèƒ½**ï¼š
1. **ç”¨æˆ·äº¤äº’ä¼˜åŒ–**
   - æ·»åŠ ã€Œåˆ·æ–° AI å†…å®¹ã€æŒ‰é’®
   - æ”¯æŒä¸­è‹±æ–‡åˆ‡æ¢æ˜¾ç¤º
   - æä¾›ã€ŒæŠ¥å‘Šé—®é¢˜ã€åé¦ˆå…¥å£

2. **å†…å®¹è´¨é‡æå‡**
   - å¼•å…¥å†…å®¹è´¨é‡è¯„åˆ†æœºåˆ¶
   - æ”¯æŒç”¨æˆ·ç‚¹èµ/ç‚¹è¸© AI å†…å®¹
   - æ ¹æ®åé¦ˆä¼˜åŒ– Prompt

3. **æ€§èƒ½ä¼˜åŒ–**
   - å®ç°æ™ºèƒ½é¢„çƒ­ï¼ˆé¢„æµ‹ç”¨æˆ·å¯èƒ½æŸ¥çœ‹çš„å†…å®¹ï¼‰
   - æ·»åŠ  SSE å®æ—¶æ¨é€ï¼ˆæ›¿ä»£è½®è¯¢ï¼‰
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼Œå‡å°‘å»¶è¿Ÿ

#### ç‰ˆæœ¬ 3.0ï¼šæ™ºèƒ½åŒ–å‡çº§ (3-4 ä¸ªæœˆ)

**æ ¸å¿ƒèƒ½åŠ›**ï¼š
1. **è¯­ä¹‰æœç´¢**
   - å¼•å…¥å‘é‡æ•°æ®åº“ï¼ˆQdrant/Milvusï¼‰
   - ç”Ÿæˆæ–‡ç«  Embedding
   - å®ç°ã€Œç›¸ä¼¼å†…å®¹æ¨èã€

2. **ä¸ªæ€§åŒ–æ¨è**
   - è®°å½•ç”¨æˆ·é˜…è¯»åå¥½
   - åŸºäºå…´è¶£æ¨èèµ„è®¯
   - æ™ºèƒ½æ’åºç®—æ³•

3. **å¤šæ¨¡å‹æ”¯æŒ**
   - æ”¯æŒåˆ‡æ¢ä¸åŒ Ollama æ¨¡å‹
   - å¯¹æ¯”ä¸åŒæ¨¡å‹çš„è¾“å‡ºè´¨é‡
   - å…è®¸ç”¨æˆ·é€‰æ‹©åå¥½æ¨¡å‹

#### ç‰ˆæœ¬ 4.0ï¼šè¿è¥å·¥å…· (6 ä¸ªæœˆ+)

**ç®¡ç†åå°**ï¼š
1. **ä»»åŠ¡ç®¡ç†**
   - å¯è§†åŒ–ä»»åŠ¡é˜Ÿåˆ—çŠ¶æ€
   - æ‰‹åŠ¨è§¦å‘/æš‚åœ/é‡è¯•ä»»åŠ¡
   - æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡é‡è¯•å¤±è´¥ä»»åŠ¡ï¼‰

2. **æ•°æ®åˆ†æ**
   - çƒ­é—¨è¯é¢˜è¶‹åŠ¿åˆ†æ
   - AI ç”Ÿæˆè´¨é‡æŠ¥å‘Š
   - ç”¨æˆ·è¡Œä¸ºåˆ†æ

3. **å†…å®¹è¿è¥**
   - ç¼–è¾‘ç²¾é€‰å†…å®¹
   - ç”Ÿæˆæ¯æ—¥ç®€æŠ¥
   - å¯¼å‡ºä¸º PDF/Newsletter

### åä¸€ã€éƒ¨ç½²ä¸è¿ç»´

#### 11.1 æœ¬åœ°å¼€å‘ç¯å¢ƒ

**å¯åŠ¨æ­¥éª¤**ï¼š

```bash
# 1. å¯åŠ¨ MySQL
docker run -d -p 3306:3306 \
  -e MYSQL_ROOT_PASSWORD=password \
  -e MYSQL_DATABASE=ai_news_dashboard \
  --name mysql-dev \
  mysql:8.0

# 2. å¯åŠ¨ Redis
redis-server

# 3. å¯åŠ¨ Ollama
ollama serve

# 4. ä¸‹è½½æ¨¡å‹ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
ollama pull qwen2.5:7b

# 5. è¿è¡Œæ•°æ®åº“è¿ç§»
pnpm prisma db push

# 6. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ + Worker
pnpm dev:all
```

#### 11.2 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

**æ¶æ„å»ºè®®**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è´Ÿè½½å‡è¡¡ (Nginx/Traefik)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”
â”‚ Next.jsâ”‚       â”‚ Next.js  â”‚  (å¤šå®ä¾‹)
â”‚ Server â”‚       â”‚ Server   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  MySQL Primary    â”‚
    â”‚  (ä¸»åº“)            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  MySQL Replica    â”‚  (å¯é€‰,è¯»å†™åˆ†ç¦»)
    â”‚  (ä»åº“)            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Redis Cluster    â”‚  (ä»»åŠ¡é˜Ÿåˆ—)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Ollama Server    â”‚  (ç‹¬ç«‹æœåŠ¡å™¨)
    â”‚  (GPU åŠ é€Ÿ)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Worker Instances â”‚  (å¤šä¸ª Worker å®ä¾‹)
    â”‚  (PM2 ç®¡ç†)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Docker Compose ç¤ºä¾‹**ï¼š

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}
      MYSQL_DATABASE: ai_news_dashboard
    volumes:
      - mysql-data:/var/lib/mysql
    ports:
      - "3306:3306"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data

  next-app:
    build: .
    environment:
      DATABASE_URL: mysql://root:${DB_PASSWORD}@mysql:3306/ai_news_dashboard
      REDIS_HOST: redis
      OLLAMA_BASE_URL: http://ollama:11434
    ports:
      - "3000:3000"
    depends_on:
      - mysql
      - redis

  worker:
    build: .
    command: pnpm worker
    environment:
      DATABASE_URL: mysql://root:${DB_PASSWORD}@mysql:3306/ai_news_dashboard
      REDIS_HOST: redis
      OLLAMA_BASE_URL: http://ollama:11434
    depends_on:
      - mysql
      - redis
      - next-app

volumes:
  mysql-data:
  redis-data:
```

#### 11.3 ç›‘æ§ä¸å‘Šè­¦

**æ¨èå·¥å…·**ï¼š
- **æ—¥å¿—**ï¼šGrafana Loki / ELK Stack
- **ç›‘æ§**ï¼šPrometheus + Grafana
- **å‘Šè­¦**ï¼šAlertManager
- **APM**ï¼šSentry (é”™è¯¯è¿½è¸ª)

**å…³é”®æŒ‡æ ‡ç›‘æ§**ï¼š

```typescript
// src/lib/metrics.ts
import { register, Counter, Histogram, Gauge } from 'prom-client';

// AI ä»»åŠ¡è®¡æ•°å™¨
export const aiTaskCounter = new Counter({
  name: 'ai_tasks_total',
  help: 'Total number of AI tasks processed',
  labelNames: ['status'], // pending, completed, failed
});

// AI å¤„ç†æ—¶é—´ç›´æ–¹å›¾
export const aiProcessingDuration = new Histogram({
  name: 'ai_processing_duration_seconds',
  help: 'AI processing duration in seconds',
  buckets: [1, 3, 5, 10, 30, 60],
});

// é˜Ÿåˆ—é•¿åº¦
export const queueLength = new Gauge({
  name: 'ai_queue_length',
  help: 'Current length of AI task queue',
});

// æš´éœ²æŒ‡æ ‡ç«¯ç‚¹
// src/app/api/metrics/route.ts
export async function GET() {
  return new Response(await register.metrics(), {
    headers: { 'Content-Type': register.contentType },
  });
}
```

### åäºŒã€FAQ ä¸æœ€ä½³å®è·µ

#### Q1: Ollama æ¨¡å‹è¿è¡Œæ…¢æ€ä¹ˆåŠï¼Ÿ

**A**: ä¼˜åŒ–æ–¹æ¡ˆï¼š
1. ç¡®ä¿ä½¿ç”¨ 7B æ¨¡å‹è€Œé 14B/27B
2. å‡å°‘ `num_predict` å‚æ•°ï¼ˆç”Ÿæˆ token æ•°ï¼‰
3. ç¼©çŸ­ Prompt é•¿åº¦
4. å‡çº§ç¡¬ä»¶ï¼ˆå¢åŠ  RAM åˆ° 16GB+ï¼‰
5. è€ƒè™‘ä½¿ç”¨é‡åŒ–æ¨¡å‹ï¼ˆå¦‚ `qwen2.5:7b-instruct-q4_0`ï¼‰

#### Q2: å¦‚ä½•å¤„ç†é«˜å¹¶å‘æƒ…å†µï¼Ÿ

**A**: ç­–ç•¥ï¼š
1. é™åˆ¶ Worker å¹¶å‘æ•°ï¼ˆå»ºè®® 2-3ï¼‰
2. ä½¿ç”¨ BullMQ çš„ `limiter` é™æµ
3. æ·»åŠ  Redis åˆ†å¸ƒå¼é”
4. æ•°æ®åº“è¿æ¥æ± é…ç½®ï¼ˆmax: 10ï¼‰
5. è€ƒè™‘ä½¿ç”¨å¤šä¸ª Ollama å®ä¾‹

#### Q3: å¦‚ä½•æå‡ AI ç”Ÿæˆè´¨é‡ï¼Ÿ

**A**: æœ€ä½³å®è·µï¼š
1. **ç²¾å¿ƒè®¾è®¡ Prompt**ï¼š
   - æä¾›æ¸…æ™°çš„è§’è‰²å®šä½
   - ç»™å‡ºå…·ä½“çš„è¾“å‡ºæ ¼å¼è¦æ±‚
   - æä¾›å°‘é‡ç¤ºä¾‹ï¼ˆFew-shotï¼‰

2. **è´¨é‡æ£€æµ‹**ï¼š
   ```typescript
   function validateAiResponse(response: any): boolean {
     // æ£€æŸ¥æ ‡é¢˜é•¿åº¦
     if (!response.translatedTitle || response.translatedTitle.length > 100) {
       return false;
     }

     // æ£€æŸ¥æ‘˜è¦é•¿åº¦
     if (!response.summary || response.summary.length < 50 || response.summary.length > 300) {
       return false;
     }

     // æ£€æŸ¥æ˜¯å¦åŒ…å«ä¸­æ–‡
     if (!/[\u4e00-\u9fa5]/.test(response.translatedTitle)) {
       return false;
     }

     return true;
   }
   ```

3. **äººå·¥åé¦ˆå¾ªç¯**ï¼š
   - è®°å½•ä½è´¨é‡ç”Ÿæˆ
   - å®šæœŸåˆ†æé—®é¢˜æ¨¡å¼
   - è¿­ä»£ä¼˜åŒ– Prompt

#### Q4: æ•°æ®åº“å¦‚ä½•ä¼˜åŒ–ï¼Ÿ

**A**: ä¼˜åŒ–æ¸…å•ï¼š
1. **ç´¢å¼•ä¼˜åŒ–**ï¼š
   ```sql
   -- å¤åˆç´¢å¼•
   CREATE INDEX idx_status_created ON ai_enhanced_content(status, created_at);

   -- è¦†ç›–ç´¢å¼•
   CREATE INDEX idx_cover ON ai_enhanced_content(id, status, translated_title, ai_summary);
   ```

2. **æŸ¥è¯¢ä¼˜åŒ–**ï¼š
   ```typescript
   // ä½¿ç”¨ select å‡å°‘æ•°æ®ä¼ è¾“
   const content = await prisma.aiEnhancedContent.findMany({
     select: {
       id: true,
       translatedTitle: true,
       aiSummary: true,
       status: true,
     },
     where: { id: { in: ids } },
   });
   ```

3. **å®šæœŸæ¸…ç†**ï¼š
   ```sql
   -- åˆ é™¤ 30 å¤©å‰çš„å¤±è´¥ä»»åŠ¡
   DELETE FROM ai_enhanced_content
   WHERE status = 'failed'
   AND created_at < NOW() - INTERVAL 30 DAY;
   ```

#### Q5: å¦‚ä½•ä¿è¯æœåŠ¡ç¨³å®šæ€§ï¼Ÿ

**A**: ç¨³å®šæ€§ä¿éšœï¼š
1. **å¥åº·æ£€æŸ¥**ï¼š
   ```typescript
   // src/app/api/health/route.ts
   export async function GET() {
     const checks = await Promise.allSettled([
       prisma.$queryRaw`SELECT 1`, // æ•°æ®åº“
       redis.ping(), // Redis
       fetch('http://localhost:11434/api/tags'), // Ollama
     ]);

     const healthy = checks.every(c => c.status === 'fulfilled');

     return NextResponse.json(
       { status: healthy ? 'ok' : 'degraded', checks },
       { status: healthy ? 200 : 503 }
     );
   }
   ```

2. **é™çº§ç­–ç•¥**ï¼š
   - AI æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨é™çº§åˆ°åŸå§‹å†…å®¹
   - æ•°æ®åº“æŸ¥è¯¢å¤±è´¥æ—¶ï¼Œè¿”å›ç¼“å­˜æ•°æ®
   - ä»»åŠ¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œæ‹’ç»æ–°ä»»åŠ¡å¹¶æç¤º

3. **é‡è¯•æœºåˆ¶**ï¼š
   - BullMQ è‡ªåŠ¨é‡è¯•ï¼ˆ3 æ¬¡ï¼‰
   - æŒ‡æ•°é€€é¿ç­–ç•¥
   - è®°å½•é‡è¯•æ—¥å¿—

### åä¸‰ã€æ€»ç»“

æœ¬ PRD è®¾è®¡äº†ä¸€å¥—å®Œæ•´çš„ AI æ™ºèƒ½å¢å¼ºæ–¹æ¡ˆï¼Œæ ¸å¿ƒä¼˜åŠ¿ï¼š

âœ… **é›¶æˆæœ¬è¿è¥**ï¼šä½¿ç”¨æœ¬åœ° Ollama æ¨¡å‹ï¼Œæ—  API è´¹ç”¨
âœ… **é«˜æ€§èƒ½æ¶æ„**ï¼šBullMQ ä»»åŠ¡é˜Ÿåˆ— + æ•°æ®åº“ç¼“å­˜ï¼Œé¿å…é‡å¤è°ƒç”¨
âœ… **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**ï¼šå¼‚æ­¥å¤„ç† + é™çº§å±•ç¤ºï¼Œä¸å½±å“é¡µé¢åŠ è½½
âœ… **æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºåç»­è¿­ä»£ä¼˜åŒ–
âœ… **ç”Ÿäº§çº§å¯é æ€§**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†ã€ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

**å…³é”®æˆåŠŸå› ç´ **ï¼š
1. Qwen2.5 æ¨¡å‹çš„ä¸­æ–‡èƒ½åŠ›
2. BullMQ çš„ä»»åŠ¡è°ƒåº¦èƒ½åŠ›
3. æ•°æ®åº“ç¼“å­˜çš„å‘½ä¸­ç‡
4. Prompt å·¥ç¨‹çš„è´¨é‡

**é¢„æœŸæ•ˆæœ**ï¼š
- ç”¨æˆ·å¯å¿«é€Ÿæµè§ˆä¸­æ–‡æ ‡é¢˜å’Œæ‘˜è¦
- AI è¦†ç›–ç‡è¾¾ 95% ä»¥ä¸Š
- å¹³å‡ç”Ÿæˆæ—¶é—´ 5 ç§’/æ¡
- ç³»ç»Ÿç¨³å®šæ€§ 99.5%+

ç¥é¡¹ç›®å®æ–½é¡ºåˆ©ï¼ğŸš€
